
<VirtualHost *>
    ServerName ch.wikimedia.org
    RewriteEngine On
    RewriteRule ^.*$    http://www.wikimedia.ch/ [R=302]
</VirtualHost>

# Chapter wikis
<VirtualHost *>
    ServerName wikimedia-chapter
    ServerAlias no.wikimedia.org nl.wikimedia.org www.nl.wikimedia.org pl.wikimedia.org nz.wikimedia.org il.wikimedia.org rs.wikimedia.org pa.us.wikimedia.org uk.wikimedia.org us.wikimedia.org se.wikimedia.org ru.wikimedia.org ua.wikimedia.org co.wikimedia.org fi.wikimedia.org ve.wikimedia.org br.wikimedia.org dk.wikimedia.org tr.wikimedia.org noboard.chapters.wikimedia.org mk.wikimedia.org et.wikimedia.org nyc.wikimedia.org mx.wikimedia.org ar.wikimedia.org bd.wikimedia.org be.wikimedia.org
    UseCanonicalName off
    DocumentRoot "/srv/deployment/mediawiki/common/docroot/wikimedia.org"

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteMap lowercase int:tolower

    # Uploads to the host-specific directory
    # First grab the subdomain from HTTP_HOST
    RewriteCond %{HTTP_HOST} ([a-z\-]+)\.wikimedia\.org
    # Now use it
    RewriteRule ^/upload/(.*)$ http://upload.wikimedia.org/wikimedia.org/%1/$1 [R=302]

    # Primary wiki redirector:
    Alias /wiki /srv/deployment/mediawiki/common/docroot/wikimedia.org/w/index.php
    RewriteRule ^/$ /w/index.php

    # www. prefix
    RewriteCond %{HTTP_HOST} ^www.([a-z]+).wikimedia.org$
    RewriteRule ^(.*)$ http://%1.wikimedia.org$1 [R=301,L]

    # UseMod compatibility URLs
    RewriteCond %{QUERY_STRING} ([^&;]+)
    RewriteRule ^/wiki\.cgi$ /w/index.php?title=%1 [R=301,L]
    RewriteRule ^/wiki\.cgi$ /w/index.php [R=301,L]

    RewriteRule ^/math/(.*) http://upload.wikimedia.org/math/$1 [R=301]

    <Directory "/srv/deployment/mediawiki/common/docroot/wikimedia.org/w">
       <IfModule mod_php5.c>
           php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/srv/deployment/mediawiki/common/docroot/wikimedia.org/w/extensions">
       <IfModule mod_php5.c>
           php_admin_flag engine off
        </IfModule>
    </Directory>

    # Stats
    RewriteRule ^/stats(/(.*$)|$) http://wikimedia.org/stats/%{HTTP_HOST}/$1 [R=301,L]
    # Load robots.txt from the wiki
    RewriteRule ^/robots.txt$ /w/robots.php [L]

</VirtualHost>


# Experimental "labs" wikis
<VirtualHost *>
    ServerName wikimedia-labs
    ServerAlias *.labs.wikimedia.org
    UseCanonicalName off
    DocumentRoot "/srv/deployment/mediawiki/common/docroot/wikimedia.org"

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteMap lowercase int:tolower

    # Uploads to the host-specific directory
    # First grab the subdomain from HTTP_HOST
    RewriteCond %{HTTP_HOST} ([a-z\-]+)\.wikimedia\.org
    # Now use it
    RewriteRule ^/upload/(.*)$ http://upload.wikimedia.org/wikimedia.org/%1/$1 [R=302]

    # Primary wiki redirector:
    Alias /wiki /srv/deployment/mediawiki/common/docroot/wikimedia.org/w/index.php
    RewriteRule ^/$ /w/index.php

    # UseMod compatibility URLs
    RewriteCond %{QUERY_STRING} ([^&;]+)
    RewriteRule ^/wiki\.cgi$ /w/index.php?title=%1 [R=301,L]
    RewriteRule ^/wiki\.cgi$ /w/index.php [R=301,L]

    RewriteRule ^/math/(.*) http://upload.wikimedia.org/math/$1 [R=301]

    <Directory "/srv/deployment/mediawiki/common/docroot/wikimedia.org/w">
       <IfModule mod_php5.c>
           php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/srv/deployment/mediawiki/common/docroot/wikimedia.org/w/extensions">
       <IfModule mod_php5.c>
           php_admin_flag engine off
        </IfModule>
    </Directory>

    # Stats
    RewriteRule ^/stats(/(.*$)|$) http://wikimedia.org/stats/%{HTTP_HOST}/$1 [R=301,L]
</VirtualHost>

<VirtualHost *>
    DocumentRoot "/srv/deployment/mediawiki/common/docroot/bits/"
    ServerName bits.wikimedia.org

    # Version-independent aliases for backwards-compatibility
    Alias /w/extensions/ /srv/deployment/mediawiki/common/docroot/wikimedia.org/w/extensions/
    Alias /skins-1.5/ /srv/deployment/mediawiki/common/php/skins/
    Alias /skins/ /srv/deployment/mediawiki/common/php/skins/

    Alias /images/ /srv/deployment/mediawiki/common/images/
    Alias /centralnotice/ /mnt/upload6/centralnotice/
    <IfModule mod_php5.c>
	php_admin_flag engine off
    </IfModule>
    # Aliases for 1.17 wikis
    Alias /w/extensions-1.17/ /srv/deployment/mediawiki/common/live-1.5/extensions-1.17/
    Alias /skins-1.17/ /srv/deployment/mediawiki/common/live-1.5/skins-1.17/
</VirtualHost>

# job.w.o
# #
<VirtualHost *>
	ServerName jobs.wikimedia.org

        RewriteEngine On
	RewriteRule ^/$		http://wikimediafoundation.org/wiki/Work_with_us
        RewriteRule ^/(.*)$     http://wikimediafoundation.org/wiki/Job_openings/$1
</VirtualHost>

<VirtualHost *>
    ServerName wikimedia.org
    Redirect permanent / http://www.wikimedia.org/
</VirtualHost>

# wikimedia.org
<VirtualHost *>
    DocumentRoot "/srv/deployment/mediawiki/common/docroot/www.wikimedia.org"
    ServerName www.wikimedia.org
    ServerAlias *.wikimedia.org

    # Main page portal
    RewriteRule ^/$ /w/extract2.php?title=Www.wikimedia.org_portal&template=Www.wikimedia.org_template [L]

    # Redirects for country portals from the old URLs
    RewriteRule ^/ch-portal/?$ http://wikipedia.ch/ [R=301,L]
    RewriteRule ^/be-portal/?$ http://wikipedia.be/ [R=301,L]
    RewriteRule ^/nl-portal/?$ http://wikipedia.nl/ [R=301,L]

    AddDefaultCharset Off
    ExpiresActive On

    # Redirect wiki which was previously at this location
    RewriteEngine On
    RewriteRule ^/wiki/(.*)$ http://wikimediafoundation.org/wiki/$1 [R=301,L]

  <Directory "/srv/deployment/mediawiki/common/docroot/www.wikimedia.org/w">
   <IfModule mod_php5.c>
    php_admin_flag engine on
   </IfModule>
  </Directory>

</VirtualHost>

# vim: sts=4 sw=4 syn=apache autoindent
